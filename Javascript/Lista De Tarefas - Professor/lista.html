<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Tarefas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="container-todo-princic">
        <div class="container-add-todo">
            <h1>To-do List</h1>
            <form id="form-todo">
                <input type="text" id="todo-input" placeholder="New item" autocomplete="off" required >
                <input type="submit" id="add-todo-button" value="Add">
            </form>
        </div>
        <div class="container-todo-item" ">
            <ul id="todo-list">

            </ul>
        </div>
    </div>
    <script>
        
        (function(){
            // Selecionando os elementos do DOM
            const formSubmit = document.getElementById('form-todo');
            const inputNewItem = document.getElementById('todo-input');
            const btnAdd = document.getElementById("add-todo-button");
            const containerAddItem = document.getElementById("todo-list");
            const lis = containerAddItem.getElementsByTagName("li");

            // Array para armazenar as tarefas
            // Inicializando com uma tarefa de exemplo
            let arrTasks = getSavedData();

           /*  function addEventli(li){
                li.addEventListener('click', function(){
                    console.log(this);
                })
            } */

            function getSavedData(){
                let tasksData = localStorage.getItem("tasks");
                console.log(tasksData);
                tasksData = JSON.parse(tasksData);
                
                return tasksData.length ?  tasksData : [

                    {
                        name: "task 1",
                        createAt: Date.now(),
                        completed: true
                    },

                    {
                        name: "task 2",
                        createAt: Date.now(),
                        completed: false
                    }
                ] ;

                 
            }

            function setNewData(){
                localStorage.setItem("tasks", JSON.stringify(arrTasks));
            }

            setNewData();

            // Função para gerar o elemento <li> com a tarefa
            // e seus botões de ação
            function ganarateLiTask(obj){

                // Criando os elementos necessários
                // e atribuindo classes e atributos
                const createItemTask = document.createElement("li");
                const createParagraf = document.createElement("p");
                const checkButton = document.createElement("button");
                const editBUtton = document.createElement("i");
                const deleteButton = document.createElement("i");

                editBUtton.className = 'fas fa-edit';
                editBUtton.setAttribute("data-action", "editButton")

                deleteButton.className = 'fas fa-trash-alt';
                deleteButton.setAttribute("data-action", "deleteButton");


                createItemTask.classList = "todo-item";
                checkButton.className = "button-check";  
                checkButton.innerHTML =  
                `  <i class="fas fa-check" ${obj.completed ? '' : 'displayNone'} data-action="checkButton"></i>`   ;
                checkButton.setAttribute("data-action", "checkButton");

                createItemTask.appendChild(checkButton)

                createParagraf.textContent = obj.name;
                createItemTask.appendChild(createParagraf);

                // Adicionando os botão de editar e excluir
                const divContainerEdit = document.createElement("div");
                divContainerEdit.className = "editContainer";
                const createInputEdit = document.createElement("input");
                createInputEdit.setAttribute("type", 'text');
                createInputEdit.className = 'editInput';
                createInputEdit.value = obj.name;
                divContainerEdit.appendChild(createInputEdit);

                // Botões de editar e cancelar edição
                // dentro do container de edição
                const containerEditButton = document.createElement("button"); 
                containerEditButton.className = 'editButton';
                containerEditButton.textContent = 'Edit';
                divContainerEdit.appendChild(containerEditButton);
                containerEditButton.setAttribute("data-action", "EditContainerBtn");
                
                const containerCalcelButton = document.createElement("button");
                containerCalcelButton.className = 'cancelButton';
                containerCalcelButton.textContent = 'Cancel'
                divContainerEdit.appendChild(containerCalcelButton);
                containerCalcelButton.setAttribute("data-action", "cancelContainerBtn");

                // Adicionando os elementos criados ao <li>
                createItemTask.appendChild(editBUtton);
                createItemTask.appendChild(deleteButton);
                createItemTask.appendChild(divContainerEdit);

                //addEventli(createItemTask);
                return createItemTask; 
            }

            // Função para renderizar as tarefas na lista
            function renderTasks(){
                containerAddItem.innerHTML = '';

                arrTasks.forEach(task => {
                    containerAddItem.appendChild(ganarateLiTask(task));
                });
            }

            // Função para adicionar uma nova tarefa ao array
            function addTask(task){
                arrTasks.push({
                    name:task,
                    createAt: Date.now(),
                    completed: false
                })

                setNewData();
            }

            // Função para remover uma tarefa do array
            function clikedUl(e){
                const dataAction = e.target.getAttribute("data-action");

                if(!dataAction) return;

                let currentLi = e.target;
                 while(currentLi.nodeName !== "LI"){
                    currentLi = currentLi.parentElement;
                }
            
                const currentLiIndex = [...lis].indexOf(currentLi);

                const actions = {
                    editButton: function (){
                        const editContainer = currentLi.querySelector(".editContainer");
                        editContainer.style.display = 'flex';
                    },
                    deleteButton : function(){
                        arrTasks.splice(currentLiIndex, 1);
                        //currentLi.remove()
                        renderTasks()
                        setNewData();
                        //currentLi.parentElement.removeChild(currentLi);
                    },

                    EditContainerBtn: function(){
                        const valInpt = currentLi.querySelector(".editInput").value;
                        if(valInpt.trim() === '') return;
                        arrTasks[currentLiIndex].name = valInpt;
                        renderTasks();
                        setNewData()
                    },
                    cancelContainerBtn: function (){
                        const editContainer = currentLi.querySelector(".editContainer")
                        editContainer.style.display = 'none';
                    },

                    checkButton: function(){
                        arrTasks[currentLiIndex].completed = !arrTasks[currentLiIndex].completed;
                        
                         if(arrTasks[currentLiIndex].completed){
                           currentLi.querySelector(".fa-check").style.display = 'flex';
                           currentLi.querySelector("p").style.textDecoration = 'line-through';
                           currentLi.querySelector("p").style.color = 'gray';
                        } 
                        else {
                            currentLi.querySelector(".fa-check").classList.add('displayNone');
                        } 
                        setNewData();
                        renderTasks()
                        

                    }

                }

                if(actions[dataAction]){
                    actions[dataAction]();
                }
            }

            // Adicionando um evento quando enviar o formulário
            formSubmit.addEventListener("submit", function(e) {
                e.preventDefault();
                addTask(inputNewItem.value);
                renderTasks();
                inputNewItem.value = '';
                inputNewItem.focus();
            })

            containerAddItem.addEventListener("click", clikedUl);

            renderTasks();

        })()

    </script>
</body>
</html>